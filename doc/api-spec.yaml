openapi: '3.0.3'
info:
  title: Hacker News 翻訳サイト API
  description: Hacker Newsの記事をGoogle Gemini APIで要約・日本語翻訳するAPI
  version: '1.0.0'

servers:
  - url: http://localhost:3000
    description: 開発環境

paths:
  /api/translate:
    post:
      summary: 記事の翻訳
      description: |
        Hacker Newsの記事情報を受け取り、Google Gemini APIでタイトルと内容を日本語に翻訳・要約する。
        翻訳結果はDBにキャッシュされ、次回以降は高速に返却される。
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StoryPayload'
            examples:
              basic:
                summary: 基本的なリクエスト
                value:
                  id: 12345678
                  title: "Show HN: A new open source project"
                  url: "https://example.com/article"
              minimal:
                summary: 最小リクエスト（URLなし）
                value:
                  id: 12345678
                  title: "Ask HN: What are you working on?"
      responses:
        '200':
          description: 翻訳成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TranslationResult'
              examples:
                success:
                  summary: 正常な翻訳結果
                  value:
                    titleJa: "Show HN: 新しいオープンソースプロジェクト"
                    summaryJa: "この記事では新しいオープンソースプロジェクトについて紹介しています。..."
                withCacheWarning:
                  summary: 翻訳成功だがキャッシュ保存失敗
                  value:
                    titleJa: "翻訳されたタイトル"
                    summaryJa: "要約テキスト"
                    cacheWarning: "Translation was generated but could not be cached due to an internal error."
                withError:
                  summary: 翻訳処理内でのエラー（部分的結果）
                  value:
                    titleJa: ""
                    summaryJa: ""
                    error: "JSON parse error in Gemini response"
        '400':
          description: リクエスト不正
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidJson:
                  summary: JSON解析エラー
                  value:
                    error: "Invalid JSON payload"
                invalidPayload:
                  summary: バリデーションエラー
                  value:
                    error: "Invalid story payload"
        '503':
          description: 翻訳サービスエラー（Gemini API障害等）
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Translation service error"

components:
  schemas:
    StoryPayload:
      type: object
      required:
        - id
        - title
      properties:
        id:
          type: integer
          description: Hacker NewsのストーリーID
          example: 12345678
        title:
          type: string
          minLength: 1
          maxLength: 256
          description: 記事タイトル
          example: "Show HN: A new open source project"
        url:
          type: string
          maxLength: 2048
          nullable: true
          description: 記事のURL（Ask HN等URLなしの場合は省略可）
          example: "https://example.com/article"
        by:
          type: string
          description: 投稿者ユーザー名（任意）
        score:
          type: integer
          description: スコア（任意）
        descendants:
          type: integer
          description: コメント数（任意）
        time:
          type: integer
          description: Unix timestamp（任意）
        type:
          type: string
          enum: [story, comment, poll, job, pollopt]
          description: アイテムタイプ（任意）

    TranslationResult:
      type: object
      required:
        - titleJa
        - summaryJa
      properties:
        titleJa:
          type: string
          description: 日本語翻訳されたタイトル
        summaryJa:
          type: string
          description: 日本語の要約テキスト
        error:
          type: string
          description: 翻訳処理中のエラーメッセージ（部分的失敗時）
        warning:
          type: string
          description: 警告メッセージ
        cacheWarning:
          type: string
          description: キャッシュ保存失敗時の警告

    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: エラーメッセージ
